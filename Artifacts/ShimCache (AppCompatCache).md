## ‚úÖ **What is it?**

ShimCache, also known as **AppCompatCache**, is a Windows feature used by the **Application Compatibility Framework**. It helps maintain compatibility for older applications by tracking **executed programs**.

Forensically, ShimCache is crucial because:

- It **records executed files**, including those that have been deleted.
- It **stores full file paths and timestamps**, which can help reconstruct attacker activity.
- It **does not require Prefetch to be enabled**, making it a great alternative when Prefetch data is missing.

‚ö†Ô∏è **Limitations:**

- It does **not** log execution timestamps in newer Windows versions.
- Entries may be **overwritten** as new programs run.
- Only **4096 entries** are stored (on Windows 10/11).

---

## **üìç Where to Find It?**

- **Registry Hive:** `SYSTEM`
- **Path:**
    
    ```
    HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache
    ```
    

---

## **üõ†Ô∏è How to Extract It (Step by Step)**

We will use **RegRipper**, a widely used tool for forensic registry extraction.

### **Method 1: Manual Extraction**

1. **Open Registry Editor (`regedit`)**
    
    - Run `regedit` as Administrator.
    - Navigate to:
        
        ```
        HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache
        ```
        
    - Export the key:
        - Right-click **AppCompatCache** ‚Üí Click **Export**.
        - Save as `.reg` file for later analysis.
2. **Convert `.reg` File for Forensic Use**
    
    - Open the `.reg` file in a text editor.
    - Extract relevant file paths manually.

---

### **Method 2: Automated Extraction with RegRipper**

**RegRipper** is a command-line tool that extracts and parses registry hives.

#### **1Ô∏è‚É£ Download RegRipper**

- Get it from **[RegRipper GitHub](https://github.com/keydet89/RegRipper3.0)**
- Extract it to a working directory.

#### **2Ô∏è‚É£ Extract the SYSTEM Hive**

Before running RegRipper, we need the **SYSTEM** hive:

- Open **Command Prompt** as Administrator.
- Run:
    
    ```cmd
    reg save HKLM\SYSTEM C:\Temp\SYSTEM.hive
    ```
    
    - This saves a copy of the SYSTEM registry hive.

#### **3Ô∏è‚É£ Run RegRipper on the SYSTEM Hive**

Navigate to the RegRipper directory and run:

```cmd
rip.exe -r C:\Temp\SYSTEM.hive -p shimcache
```

- `-r` specifies the input registry hive.
- `-p shimcache` tells RegRipper to extract ShimCache entries.

#### **4Ô∏è‚É£ Review the Output**

- The results will be displayed in the terminal and saved to a text file.
- Look for **file paths, timestamps, and evidence of deleted applications**.

---

## **üìä How to Analyze It (Step by Step)**

Once you have extracted ShimCache data, follow this structured approach to analyze it:

|**Step**|**Action**|**Details**|
|---|---|---|
|**1. Open the Parsed Output**|View the `.txt` or `.csv` file generated by RegRipper|Use Notepad++ or Excel for better readability|
|**2. Identify File Paths**|Look at the **full paths of executed programs**|Detect suspicious execution locations like `C:\Users\Public\malware.exe`|
|**3. Review Execution Timestamps**|Older versions of Windows contain `Last Modified` timestamps|Helps reconstruct an attack timeline|
|**4. Look for Deleted Files**|Files that no longer exist on disk may still appear in ShimCache|Useful for **malware that self-deletes**|
|**5. Correlate with Prefetch and Amcache**|Compare with Prefetch files and Amcache.hve|Cross-checking artifacts increases confidence|
|**6. Check for Malware Persistence**|Look for repeated execution of uncommon programs|Attackers often use persistence mechanisms that show up here|

---

## **üö® Real-World Use Cases**

### **üìå Incident Response**

- **Detect execution of deleted malware** that no longer exists on disk.
- **Correlate activity** with Windows Event Logs to confirm unauthorized execution.
- **Check rare execution paths** (`C:\Windows\Temp\evil.exe` vs `C:\Program Files\`).

### **üìå Threat Hunting**

- Investigate **newly installed programs** that aren't part of standard software.
- Identify **unexpected executions** under user profiles or public directories.

### **üìå Insider Threat Investigations**

- Discover if an employee ran unauthorized scripts or hacking tools.
- Confirm if sensitive applications (e.g., `password_cracker.exe`) were executed.

---

## **üîé Summary**

|**Category**|**Details**|
|---|---|
|**Location**|`HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache`|
|**File Type**|Stored in SYSTEM hive|
|**Extraction Tool**|`RegRipper`|
|**Key Information**|File paths, execution history, deleted programs|
|**Forensic Value**|Detects execution of deleted/malicious files|

---

